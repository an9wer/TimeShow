== Basic ==

=== How to specify a user id ===

`By key Id`: This format is deduced from the length of the string and its
content or the '0x' prefix. An exclamation mark (!) may be appended to force
using the specified primary or secondary key and not to try and calculate which
primary or secondary key to use.
{{{
    662E8566
    0662E8566
    0x662E8566

    DB4A58F6662E8566
    0DB4A58F6662E8566
    0xDB4A58F6662E8566
}}}

`By fingerprint`: This format is deduced from the length of the string and its
content or the '0x' prefix. An exclamation mark (!) may be append to force
using the specified primary or secondary key and not to try and calculate
which primary or secondary key to use.
{{{
    85295C7BBFCDF3C1061BE107A358019FB93DD1F4
    085295C7BBFCDF3C1061BE107A358019FB93DD1F4
    0x85295C7BBFCDF3C1061BE107A358019FB93DD1F4
}}}

`By exact match on OpenPGP user ID`: This is denoted by a leading euqal sign.
{{{
    =an9wer <an9wer@gmail.com>
}}}

`By exact match on an email address`: This is indicated by enclosing the email
address in the usual way in with left and right angles.
{{{
    <an9wer@gmail.com>
}}}

`By partial match on an email address`: This is indicated by prefixing the
search string with an @. This uses a substring search but considers only the
mail address.
{{{
    @9
}}}

`By substirng match`: This is the default mode but applications may want to
explicitly indicate this by putting the asterisk in frot. Match is not case
sensitive.
{{{
    9
    *9
}}}

== Common ==

=== Options ===

`--homedir dir`: Set the name of the home directory to dir. If this option is
not used, the home directory defaults to `~/.gnupg`. It is only recognized when
given on the command line. It also overrides any home directory stated throuth
the environment variable `GNUPGHOME`.

=== Examples ===

List all public keys located in specified home directory:
{{{
    gpg --homedir /path/to/homdir -k
}}}

== List keys ==

When listing secret keys with `gpg -K`, keys are marked with either sec or ssb.
When listing public keys with `gpg -k`, keys are marked with either pub or sub.

|     | Explanation   |
|-----|---------------|
| sec | secret key    |
| ssb | secret subkey |
| pub | public key    |
| sub | public subkey |

When listing either secret keys or public keys, each key has a role and is
represented by a character:

| Character | Constant          | Explanation                                 |
|-----------|-------------------|---------------------------------------------|
| S         | PUBKEY_USAGE_SIG  | key is good for signing                     |
| C         | PUBKEY_USAGE_CERT | key is good for certifying other signatures |
| E         | PUBKEY_USAGE-ENC  | key is good for encryption                  |
| A         | PUBKEY_USAGE_AUTH | key is good for authentication              |

=== Options ===

`-k --list-keys --list-public-keys`: List the specified keys. If no keys are
specified, then all keys from the configured public keyrings are listed.

`-K --list-secret-keys`: List the specified secret keys. If no keys are
specified, then all known secret keys are listed.

`--fingerprint`: List all keys (or the specified ones) along with their
fingerprints. This is the same output as `--list-keys` but with additional
output of a line with the finterprint. May also be combined with `--list-sigs`
or `--check-sigs`.

=== Examples ===

List all public keys:
{{{
    gpg -k
}}}

List all public keys specified by user id:
{{{
    gpg -k {user-id}
}}}

List all secret keys:
{{{
    gpg -K
}}}

List all secret keys specified by user id:
{{{
    gpg -K {user-id}
}}}

== Generate and delete key ==

=== Options ===

`--generate-key`: Generate a new key pair using the current default parameters.
This is the standard command to create a new key. In addition to the key a
revocation certificate is created and stored in the 'openpgp-revocs.d'
directory below the GnuPG home directory.

`--full-generate-key`: Generate a new key pair with dialogs for all options.
This is an extended version of --generate-key. There is also a feature which
allows you to create keys in batch mode.

`--delete-secret-keys name`: Remove ke from the secret keyring.

`--delete-keys name`: Remove key from the public keyring.

=== Examples ===

Generate a new key pair:
{{{
    gpg --full-generate-key
}}}

Delete secret keys:
{{{
    gpg --delete-secret-keys {user-id}
}}}

Delete public key (*Note*: It is needed to delete secret keys first):
{{{
    gpg --delete-keys {user-id}
}}}

== Revoke key ==

=== Options ===

`--gen-revoke name`: Generate a revocation certificate for the complete key. To
only revoke a subkey or a key signature, use the `--edit` option. This command
merely created the revocation certificate so that it can be used to revoke the
key if that is ever needed. To actually revoke a key that created revocation
certificate needs to be merged with the key to revoke. This is done by
importing the revocation certificate using the `--import` command. Then the
revoked key needs to be published, which is best done by sending the key to a
keyserver (--send-key) and by exporting (--export) it to a file which is then
send to frequent communication partners.

=== Examples ===

Generate a revocation:
{{{
    gpg --gen-revoke {user-id}
}}}

Revoke:
{{{
    gpg --import /path/to/file.rev
}}}

== Export key ==

=== Options ===

`-a --armor`: Create ASCII armored output. The default is to create the binary
OpenPGP format.

`-o --output file`: Write output to file.

`--export`: Either export all keys from all keyrings, or if at least one name
is given, those of the given name. The exported keys are written to STDOUT or
to the file given with option `--output`. 

`--export-secret-keys`: Same as `--export`, but exports the secret keys
instead.

`--export-secret-subkeys`: This is a GNU extension to OpenPGP and other
implementations can not be expected to successfully import such a key. Its
intended use is to generated a full key with an additional signing subkey on a
dedicated machine and then using this option to export the key without the
primary key to the main machine.

=== Examples ===

Export all public keys specified by user id:
{{{
    gpg -a --export {user-id}
}}}

Export all secret keys specified by user id:
{{{
    gpg -a --export-secret-keys {user-id}
}}}

Export subkeys (see below).

== Edit key ==

=== Options ===

`--edit-key`: Present a menu which enables you to do most of hte key management
related tasks. It expects the specification of a key on the command line.
-   `uid n`: Toggle selection of user ID or photographic user ID with index n.
    Use * to select all and 0 to deselect all.
-   `key n`: Toggle selection of subkey with index n or key ID n. Use * to
    select all and 0 to deselect all.
-   `sign`: Make a signature on key of user name If the key is not yet signed
    by the default user (or the users given with `-u`), the program displays
    the information of the key again, together with its fingerprint and asks
    whether it should be signed. This question is repeated for all users
    specified with `-u`.
-   `lsign`: Same as "sign" but the signature is marked as non-exporteable and
    will therefore never be used by others. This may be used to make keys valid
    only in the local environment.
-   `nrsing`: Same as "sign" but the signature is marked as non-revocable and
    can thereforce never be revoked.
-   `tsign`: Make a trust signature. This is a signature that combines the
    notions of certification (like a regular signature), and trust (like the
    "trust" command). It is generally only useful in distinct communities or
    groups.
-   `delsig`: Delete a signature. Note that it is not possible to retract a
    signature, once it has been send to the public (i.e. to a key server). In
    that case you better use revsig.
-   `revsig`: Revoke a signature. For every signature which has been generated
    by one of the secret keys, GnuPG asks whether a revocation certificate
    should be generated.
-   `check`: Check the signatures on all selected user IDs. With the extra
    selfsig only self-signatures are shown.
-   `adduid`: Create an additional user ID.
-   `deluid`: Delete a user ID or photographic user ID. Note that it is not
    possible to retract a user id, once it has been send to the public (i.e. to
    a key server). In that case you better use revuid.
-   `revuid`: Revoke a user ID or photographic user ID.
-   `primary`: Flag the current user id as the primary one, removes the primary
    user id flag from all other ids and sets the timestamp of all affected
    self-signatures one second ahead.
-   `addkey`: Add a subkey to this key.
-   `delkey`: Remove a subkey (secondary key). Note that it is not possible to
    retract a subkey, once it has been send to the public (i.e. to a
    keyserver). In that case you better use revkey.
-   `revkey`: Revoke a subkey.
-   `expire`: Change the key or subkey expiration time. If a subkey is
    selected, the expiration time of this subkey will be changed. With no
    selection, the key expiration of the primary key is changed.
-   `trust`: Change the owner trust value for the key. This updates the
    trust-db immediately and no save is required.
-   `disable enable`: Disable or enable an entire key. A disable key can not
    normally be used for encryption.
-   `addrevoker`: Add a designated revoker to the key. This takes one optional
    argument: "sensitive". If a designated revoker is marked as sensitive, it
    will not be exported by default.
-   `passwd`: Change the passphrase of the secret key.
-   `save`: Save all changes to the key rings and quit.
-   `quit`: Quit the program without updating the key rings.

*Note*: "l" (for local/non-exportable), "nr" (for non-revocable), and "t" (for
trust) may be freely mixed and prefixed to "sign" to create a signature of any
type desired.

`--list-sigs`: Same as `--list-keys`, but the signatures are listed too. This
command has the same effect as using `--list-keys` with `--with-sig-list`. For
each signature listed, there are several flags in between the 'sig' tag and
keyid. These flags give additional information about each signature. From left
to right, they are the numbers 1-3 for certificate check level (see
`--ask-cert-level`), 'L' for a local or non-exportable signature (see
`--lsign-key`), 'R' for a non-revocable signature (see the `--edit-key` command
'nrsing'), 'P' for a signature that contains a policy URL (see
`--cert-policy-url`), 'N' for a signature that contains a notation (see
`--cert-notation`), 'X' for a expired signature (see `--ask-cert-expire`), and
the number 1-9 or 'T' for 10 and above to indicate trust signature levels (see
the `--edit-key` command 'tsign').

`--check-sigs`: Same as `--list-sigs`, but signatures are verified. Note that
for performancce reasons the revocation status of a signing key is not shown.
This command has the same effect as using `--list-keys` with
`--with-sig-check`. The status of the verification is indicated by a flag
directly following the 'sig' tag. A '!' indicated that the signature has been
successfully verified, a '-' ddenotes a bad signaturee and a '%' is used if an
error occurred while checking the signature (e.g. a non supported algorithm).

=== Examples ===

Trust key:
{{{
    gpg> trust
}}}


Make signature for all users:
{{{
    gpg> sign
}}}

Make signaturefor a specific user:
{{{
    gpg> uid {number}
    gpg> sign
}}}

Delete signature:
{{{
    gpg> uid {number}
    gpg> delsig
}}}

Add user:
{{{
    gpg> adduid
}}}

Delete user:
{{{
    gpg> uid {number}
    gpg> deluid
}}}

Revoke user:
{{{
    gpg> uid {number}
    gpg> revuid
}}}

Set primary user:
{{{
    gpg> uid {number}
    gpg> primary
}}}

Set expire time (If key is expired, it cannot be used anymore.):
{{{
    gpg> key {number}
    gpg> expire
}}}

== Encrypt and decrypt ==

=== Options ===

`-e --encrypt`: Encrypt data to one or more public keys. This command may be
combined with `--sign`, `--symmetric`, or `--sign` and `--symmetric` together.
`--recipient` and related options specify which public keys to use for
encryption.

`-d --decrypt`: Decrypt the file given on the command line (or STDIN if no file
is specified) and write it to STDOUT (or the file specified with `--output`).
If the decrypted file is signed, the signature is also verified.

`-c --symmetric`: Entrypt with a symmetric cipher using a passphrase.

`-r --recipient name`: Encrypt for user id. If this option or
`--hidden-recipient` is not specified, GnuPG asks for the user-id unless
`--default-recipient` is given.

=== Examples ===

Use a specific public key to encrypt some file (the default name of encrypted
file is the original filename suffixed with '.gpg', but can be change by the
`-o` option):
{{{
    gpg -e -r {user-id} /path/to/file
}}}

Decrypt file:
{{{
    gpg -d /path/to/file.gpg
}}}

== Sign and verify==

The difference between the results by using `--sign` and `--clearsign` is that
the data type of the former is binary but the latter is ascii.

Ths difference between the results by using `--sign` and `--detach-sign` is
that the content of the former contains the original data, but the latter does
not.

=== Options ===

`-s --sign`: Sign a message. This command may be combined with `--encrypt`,
`--symmetric`, or both `--encrypt` and `--symmetric`. The signing key is chosen
by default or can be set explicitly using the `--local-user` and
`--default-key` options.

`--clearsign`: Make a cleartext signature. The content in a cleartext signature
is readable without any special software. OpenPGP software is only needed to
verify the signature. The signing key is chosen by default or can be set
explicitly using the `--local-user` and `--deafult-key`.

`-b --detach-sign`: Make a detached signature.

`--verify`: Assume that the first argument is a signed file and verify it
without generating any output. With no arguments, the signature packet is read
from STDIN. If only one argument is given, the specified file is expected to
include a complete signature. With more than one argument, the first argument
should specify a file with a detached signature and the remaining files should
contain the signed data. To read the signed data from STDIN, use '-' as teh
second filename. For security reasons, a detached signature will not read the
signed material from STDIN if not explicitly specified.

=== Examples ===

Sign a message to raw binary data file:
{{{
    gpg --sign --default-key {user-id} /path/to/file
}}}
The signed file by default is suffixed with `.gpg`, and can be verified by:
{{{
    gpg --verify /path/to/file.gpg
}}}

Sign a message to ascii data file:
{{{
    gpg --clearsign --default-key {user-id} /path/to/file
}}}
The signed file by default is suffixed with `.asc`, and can be verified by:
{{{
    gpg --verify /path/to/file.asc
}}}

Sign a message to raw binary data file but abandon original data content.
{{{
    gpg --detach-sign --default-key {user-id} /path/to/file
}}}
The signed file by default is suffixed with `.gpg`, and can be verified by:
{{{
    gpg --verify  /path/to/file.gpg /path/to/file
}}}

== Subkeys ==

=== Create subkeys ===

First, enter edit-key menu of some user:
{{{
    gpg --edit-key {user-id}
}}}

Then, use addkey command and follow the promption to create a subkey:
{{{
    gpg> addkey
}}}

=== Delete subkeys ===

First, enter edit-key menu specified by user id:
{{{
    gpg --edit-key {user-id}
}}}

Then, use positive number to select key:
{{{
    gpg> key {number}
}}}

Last, use delkey command to delete that key:
{{{
    gpg> delkey
}}}

=== Export subkeys ===

Export all subkeys specified by user id:
{{{
    gpg --armor --export-secret-subkeys {user-id}
}}}

Export a specific subkey (can be displayed by the
`gpg --keyid-format long -K {user-id}` command).
{{{
    gpg --armor --export-secret-subkeys {subkey-id}!
}}}
*Note*: The subkey-id should be suffixed with exclamation mark (!).

=== Encrypt and decrypt ===

Encrypt by a specific subkey:
{{{
    gpg -r {subkey-id}! -e /path/to/file
}}}

Decrypt:
{{{
    gpg -d /path/to/file.gpg
}}}

*Note*: When using a specific (public) subkey to encrypt files, only the
corresponding (secret) subkey can decrypt them.

=== Revoke subkeys ===

First, enter edit-key menu specified by user id:
{{{
    gpg --edit-key {user id}
}}}

Then, use key command to select key:
{{{
    gpg> key {number}
}}}

Last, use revkey command to delete that key:
{{{
    gpg> revkey
}}}

== Ownertrust ==

=== Options ===

`--export-ownertrust`: Send the ownertrust values to STDOUT. This is useful for
backup purposes as these values are the only ones which can't be re-created
from a corrupted trustdb.

`--import-ownertrust`: Update the trustdb with the ownertrust values stored in
files (or STDIN if not given); existing values will be overwritten.

=== Examples ===

Export ownertrust:
{{{
    gpg --export-ownertrust > /path/to/ownertrust.txt
}}}

Import ownertrust:
{{{
    gpg --import-ownertrust < /path/to/ownertrust.txt
}}}

== gpg.conf ==

`gpg.conf` is an options file which by default is located in `~/.gnupg/`. Long
options can be put in options file. Short option names will not work - for
example, "armor" is a valid option for the options file, while "a" is not. Do
not write the 2 dashes, but simply the name of the option and any required
arguments. Lines with a hash ('#') as the first non-white-space character are
ignored. Commands may be put in this file too, but that is not generally useful
as the command will execute automatically with every execution of gpg.

=== Options ===

`--default-key name`: Use name as the default key to sign with. If this option
is not used, the default key is the first key found in the secret keyring. Note
that the `-u` or `--local-user` overrides this option. This option may be given
multiple times. In this case, the last key for which a secret key is available
is used. If there is no secret key available for any of the specified values,
GnuPG will not emit an error message but continue as if this option wasn't
given.

`--default-recipient name`: Use name as default recipient if option
`--recipient` is not used and don't ask if this is a valid one.

`--default-recipient-self`: Use the default key as default recipient if option
`--recipient` is not used and don't ask if this is a valid one. The default key
is the first one from the secret keyring or the one set with `--default-key`.

`--no-default-recipient`: Reset `--default-recipient` and
`--default-recipient-self`.

`--keyid-format {none|short|0xshort|long|0xlong}`: Select how to display key
IDs. "none" does not show the key ID at all but shows the fingerprint in a
separate line. "short" is the traditional 8-character key ID. "long" is the
more accurate 16-character key ID. Add an "0x" to either to include an "0x" at
the beginning of the key ID, as in 0x99242560. Note that this option is ignored
if the option `--with-colons` is used.

`--with-fingerprint`: Same as the command `--finterprint` but chagnes only the
format of the output and may be used together with another command.

`--with-subkey-fingerprint`: If a fingerprint is printed for the primary key,
this option forces printing of the fingerprint for all subkeys.

== Keyserver ==

=== Options ===

`--keyserver name`: Use name as your keyserver. This is the server that
`--recv-keys`, `--send-keys`, and `--search-keys` will communicate with to
receive keys from, send keys to, and search for keys on. (Note that this
options is deprecated, use the --keyserver in 'dirmngr.conf' instead.)

`--recv-keys key-ids` Import the keys with the given key IDs from a keyserver.

`--refresh-keys`: Request updates from a keyserver for keys that already exist
on the local keyring. This is useful for updating a key with the latest
signatures, user IDs, etc.

`--search-keys names`: Search the keyserver for the given names. Multiple names
given here will be joined togther to create the search string for the
keyserver.

`--send-keys key-ids`: similar to `--export` but sends the key to a keyserver.
Fingerprints may be used instead of key IDs.

=== Examples ===

Send keys to keyserver:
{{{
    gpg --keyserver {server} --send-keys {key-ids}
}}}

Receive keys from keyserver:
{{{
    gpg --keysever {server} --recv-keys {key-ids}
}}}

Update keys from keyserver:
{{{
    gpg --keyserver {server} --refresh-keys
}}}

= TODO =

-   keyserver & dirmngr

-   key expire & revoke

-   gpg-agent

-   ssh & gpg

= References =

-   `man gpg`

-   [[https://wiki.debian.org/Subkeys|Debian wiki subkeys]]

-   [[https://www.gnupg.org/gph/en/manual/x135.html|Make signatures 1]]

-   [[https://www.tutonics.com/2012/11/gpg-encryption-guide-part-3-digital.html|Make signatures 2]]

-   [[https://www.gnupg.org/gph/en/manual/x334.html|Validate key]]

-   [[https://en.wikipedia.org/wiki/Public_key_fingerprint|Public key fingerprint]]
