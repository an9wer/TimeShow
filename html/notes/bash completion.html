<!DOCTYPE html>
<html>
<head>
    <title>an9wer's blog</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../statics/css/style.css" type="text/css" />
    <link rel="icon" href="../statics/images/icon.jpg" type="image/jpeg" size="32x32"/>
</head>
<body>
<div id="main">
    <div id="header">
        <div id="headerLeft">
            <div id="name"><a href="index.html">an9wer's blog</a></div>
            <div id="signature">just stick to it :)</div>
        </div>
        <div id="headerRight">
            <div id="avatar">
                <a href="https://github.com/an9wer" target="_blank"><img src="../statics/images/avatar.jpg"></a>
            </div>
        </div>
    </div>
    <div id="navbar">
        <a id="blog" href="../blog/index.html">Blog</a>
        <a id="notes" class="current" href="index.html">Notes</a>
        <a id="about" href="../about.html">About</a>
    </div>
    <div id="post">
        <div id="title">bash completion</div>
        <div id="content">
<div id="Programmable Completion"><h1 id="Programmable Completion">Programmable Completion</h1></div>

<p>
When word completion is attempted for an argument to a command for which a
completion specification (a compspec) has been defined using the <code>complete</code>
builtin, the programmable completion facilities are invoked.
</p>

<p>
First, the command name is identified. If the command word is the empty string
(completion attempted at the beginning of an empty line), any compspec defined
with the <code>-E</code> option to <code>complete</code> is used. If a compspec has been defined for
that command, the compspec is used to generate the list of possible completions
for the word. If the command word is a full pathname, a compspec for the full
pathname, an attempt is made to find a compspec for the portion following the
final slash. If those searches do not result in a compspec, any compspec
defined with the <code>-D</code> option to <code>complete</code> is used as the default. If there is
no default compspec, bash attempts alias expansion on the command word as a
final resort, and attempts to find a compspec for the command word from any
successful expansion.
</p>

<p>
Once a compspec has been found, it is used to generate the list of matching
words. If a compspec is not found, the default bash completion as described
above under Completing is performed.
</p>

<p>
First, the actions specified by the compspec are used. Only mathes which are
prefixed by the word being completed are returned. When the <code>-f</code> or <code>-d</code> option
is used for filename or directory name completion, the shell variable
<code>FIGNOREB</code> is used to filter the matches.
</p>

<p>
Any completions specified by a pathname expansion pattern to the <code>-G</code> option
are generated next. The words generated by the pattern need not match the word
being completed. The <code>GLOBIGNORE</code> shell variable is not used to filter the
matches, but the <code>FIGNORE</code> variable is used.
</p>

<p>
Next, the string specified as the argument to the <code>-W</code> option is considered.
The string is first split using the characters in the <code>IFS</code> special variable as
delimiters. Shell quotiong is hornored. Each word is then expanded using brace
expansion, tilde expansion, parameter and variable expansion, command
substitution, and arithmetic expansion. The results are split using the Word
Spliting rules. The results of the expansion are prefix-matched against the
word being completed, and the matching words become the possible completions.
</p>

<p>
After these matches have been generated, any shell function or command
specified with the <code>-F</code> and <code>-C</code> options is invoked. When the command or
function is invoked, the <code>COMP_LINE</code>, <code>COMP_POINT</code>, <code>COMP_KEY</code>, and <code>COMP_TYPE</code>
variables are assigned values. If a shell function is being invoked, the
<code>COMP_WORDS</code> and <code>COMP_CWORD</code> variables are also set. When the function or
command is invoked, the first argument ($1) is the name of the command whose
arguments are being completed, the second argument ($2) is the word being
completed on the current command line. No filtering of the generated
completions against the word being completed is performed; the function or
command has complete freedom in generating the matches.
</p>

<p>
Any function specified with <code>-F</code> is invoked first. The function may use any of
the shell facilities, including the <code>compgen</code> builtin. to generate the matches.
It must put the possible completions in the <code>COMPREPLY</code> array variable, one per
array element.
</p>

<p>
Next, any command specified with the <code>-C</code> option is invoked in an environment
equivalent to command substitution. It should print a list of completions, one
per line, to the standard output. Backslash may be used to escape a newline, if
necessary.
</p>

<p>
After all of the possible completions are generated, any filter specified with
the <code>-X</code> option is applied to the list. The filter is a pattern as used for
pathname expansion; a <code>&amp;</code> in the pattern is replaced with the text of the word
being completed. A literal <code>&amp;</code> may be escaped with a backslash; the backslash
is removed berfore attempting a match. Any completion that matches the pattern
will be removed from the list. A leading <code>!</code> negates the pattern; in this case
any completion not matching the pattern will be removed. If the <code>nocasematch</code>
shell option is enabled, the match is performed without regard to the case of
alphabetic characters.
</p>

<p>
Finally, any prefix and suffix specified with the <code>-P</code> and <code>-S</code> options are
added to each member of the completion list, and the result is returned to the
readline completion code as the list of possible completions.
</p>

<p>
If the previously-applied actions do not generate any matches, and the
<code>-o dirname</code> option was supplied to <code>complete</code> when the compspec was defined,
directory name completion is attempted.
</p>

<p>
If the <code>-o plusdirs</code> option was supplied to <code>complete</code> when the compspec was
defined, directory name completion is attempted and any matches are added to
the results of the other actions.
</p>

<p>
By default , if a compspec is found, whatever it generates is returned to the
completion code as the full set of possible completions. The default bash
completions are not attempted, and the readline default of filename completion
is disbled. If the <code>-o bashdefault</code> option was supplied to <code>complete</code> when the
compspec was defined, the bash bash default completions are attempeted if the
compspec generates no matches. If the <code>-o default</code> option was supplied to
compspec when the compspec was defined, readline's default completion will be
performed if the compspec (and, if attempted, the default bash completions)
generate no matches.
</p>

<p>
When a compspec indicates that direcotry name completion is desired, the
programmable completion functions force readline to append a slash to completed
names which are symbolic links to directories, subject to the value of the
<code>mark-directories</code> readline variable, regardless of the setting of the
<code>mark-symlinked-direcotries</code> readline variable.
</p>

<p>
There is some support for dynamically modifying completions. This is most
useful when used in combination with a default completion specified with
<code>complete -D</code>. It's possible for shell functions execute as completion handlers
to indicate teh completion should be retried by returning an exit status of
</p>
<ol>
<li>
If a shell function returns 124, and changes the compspec associated with

</ol>
<p>
the command on which completion is being attempted (supplied as the first
argument when the function is executed), programmable completion restarts from
the beginning, with an attempt to find a new compspec for that command. This
allows a set of completions to be built dynameically as completion is
attempted, rather than being loaded all at once.
</p>

<div id="compgen"><h1 id="compgen">compgen</h1></div>

<pre>
    compgen [option] [word]
</pre>

<p>
Generate possible completion matches for word according to the options, which
may be any option accepted by the <code>complete</code> builtin with the exception of <code>-p</code>
and <code>-r</code>, and write the matches to the standard output. When using the <code>-F</code> or
<code>-C</code> options, the various shell variables set by the programmable completion
facilities, while available, will not have useful values.
</p>

<p>
The matches will be generated in the same way as if the programmable completion
code had generated them directly from a completion specification with the same
flags. If word is specified, only those completions matching word will be
displayed.
</p>

<p>
The return value is true unless an invalid option is supplied, or no matches
were generated.
</p>

<div id="complete"><h1 id="complete">complete</h1></div>

<pre>
    complete [-abcdefgjksuv] [-o comp-option] [-DE] [-A action] [-G globpat]
        [-W wordlist] [-F function] [-C command] [-X filterpat] [-P prefix]
        [-S suffix] name [name ...]
</pre>

<pre>
    complete -pr [-DE] [name ...]
</pre>

<p>
Specify how arguments to each name should be completed. If the <code>-p</code> option is
supplied, or if no options are supplied, existing completion specifications are
printed in a way that allows them to be reused as input. The <code>-r</code> option
removes a completion specification for each name, or, if no names are supplied,
all completion specifications. The <code>-D</code> option indicates that the remaining
options and actions should apply to the "default" command completion; that is,
completion attempted on a command for which no completion has previously been
defined. The <code>-E</code> option indicates that the remaining options and actions
should apply to "empty" command completion; that is, completion attempted on a
blank line.
</p>

<p>
Other options, if specified, have the following meanings. The arguments to the
<code>-G</code>, <code>-W</code>, and <code>-X</code> options (and, if necessary, the <code>-P</code> and <code>-S</code> options)
should be quoted to protect them from expansion before the complete builtin is
invoked.
</p>

<p>
<code>-o comp-option</code>: The comp-option controls several aspects of the compspec's
behavior beyond the simple generation of completions.
</p>
<ul>
<li>
  <code>bashdefault</code>: Perform the rest of the default bash completions if the
    compspec generates no matches.

<li>
  <code>default</code>: Use readline's default filename completion if the compspec
    generates no matches.

<li>
  <code>dirnames</code>: Perform directory name completion if the compspec generates no
    matches

<li>
  <code>filenames</code>: Tell readline that the compspec generates filenames, so it can
    perform any filename-specific processing (like adding a slash to directory
    names, quoting special characters, or suppressing trailing spaces).
    Intended to be used with shell functions.

<li>
  <code>noquote</code>: Tell readline not to quote the completed words if they are
    filenames (quoting filenames is the default).

<li>
  <code>nosort</code>: Tell readline not to sort the list of possible completions
    alphabetically.

<li>
  <code>nospace</code>: Tell readline not to append a space (the default) to words
    completed at the end of the line.

<li>
  <code>plusdirs</code>: After any matches defined by the compspec are generated,
    directory name completion is attempted and any matches are added to the
    results of the other actions.

</ul>

<p>
<code>-A action</code>: The action may be one of the following to generate a list of
possible completions:
</p>
<ul>
<li>
  <code>alias</code>: Alias names. May also be specified as <code>-a</code>.

<li>
  <code>arrayvar</code>: Array variable names.

<li>
  <code>binding</code>: Readline keybinding names.

<li>
  <code>builtin</code>: Names of shell builtin commands. May also be specified as <code>-b</code>.

<li>
  <code>command</code>: Command names. May also be specified as <code>-c</code>.

<li>
  <code>directory</code>: Directory names. May also be specified as <code>-d</code>.

<li>
  <code>disabled</code>: Name of disabled shell builtins.

<li>
  <code>enabled</code>: Name of enabled shell builtins.

<li>
  <code>export</code>: Name of exported shell variables. May also be specified as <code>-e</code>.

<li>
  <code>file</code>: File name. May also be specified as <code>-f</code>.

<li>
  <code>function</code>: Names of shell functios.

<li>
  <code>group</code>: Group names. May also be specified as <code>-g</code>.

<li>
  <code>helptopic</code>: Help topics as accepted by the <code>help</code> builtin.

<li>
  <code>hostname</code>: Hostname, as taken from the file specified by the <code>HOSTFILE</code>
    shell variable.

<li>
  <code>job</code>: Job names, if job control is active. May also be specified as <code>-j</code>.

<li>
  <code>keyword</code>: SHell reserved words. May also be specified as <code>-k</code>.

<li>
  <code>running</code>: Names of running jobs, if job control is active.

<li>
  <code>service</code>: Service names. May also be specified as <code>-s</code>.

<li>
  <code>setopt</code>: Valid arguments for the <code>-o</code> option to the <code>set</code> builtin.

<li>
  <code>shopt</code>: Shell option names as accepted by the <code>shopt</code> builtin.

<li>
  <code>signal</code>: Signal names.

<li>
  <code>stopped</code>: Names of stopped jobs, if job control is active.

<li>
  <code>user</code>: User names, May also be specified by <code>-u</code>.

<li>
  <code>variable</code>: Names of all shell veriables. May also be specified as <code>-v</code>.

</ul>

<p>
<code>-C command</code>: command is executed in subshell environment, and its output is
used as the possible completions.
</p>

<p>
<code>-F function</code>: The shell function function is executed in the current shell
environment. When the function is executed, the first argument ($1) is the name
of the command whose arguments are being completed, the second argument ($2) is
the word being completed, and the third argument ($3) is the word preceding the
word being completed on the current command line. When it finishes, the
possible completions are retrieved from teh value of the <code>COMPREPLY</code> array
variable.
</p>

<p>
<code>-G globpat</code>: The pathname expansion pattern globpat is expanded to generate
the possible completions.
</p>

<p>
<code>-P prefix</code>: prefix is added at the beginning of each possible completion after
all other options have been applied.
</p>

<p>
<code>-S suffix</code>: suffix is appended to each possible completion after all other
options have been applied.
</p>

<p>
<code>-W wordlist</code>: The wordlist is split using the characters in the IFS special
variable as delimiters, and each resultant word is expanded. The possible
completions are the members of the resultant list which match the word being
completed.
</p>

<p>
<code>-X filterpat</code>: filterpat is a pattern as used for pathname expansion. It is
applied to the list of possible completions generated by the preceding options
and arguments, and each completion matching filterpat is removed from the list.
A leading ! in filterpat negates the pattern; in this case, any completion not
matching filterpat is removed.
</p>

<div id="compopt"><h1 id="compopt">compopt</h1></div>

<pre>
    compopt [-o option] [-DE] [+o option] [name]
</pre>

<p>
Modify completion options for each name according to the options, or for the
currently-executing completion if no names are supplied. If no options are
given, display the completion options for each name or the current completion.
The possible values of option are those valid for the <code>complete</code> builtin. The
<code>-D</code> option indicates that the remaining options should apply to the "default"
command completion; that is, completion attempted on a command for which no
completion has previously been defined. The <code>-E</code> option indicates that the
remaining options should apply to "empty" command completion; that is,
completion attempted on a blank line.
</p>

<p>
The return value is true unless an invalid option is supplied, an attempt is
made to modify the options for a name for which no completion specification
exists, or an output error occurs.
</p>

<div id="Examples"><h1 id="Examples">Examples</h1></div>

<p>
Display all existing completion specification:
</p>
<pre>
    complete
</pre>
<p>
or:
</p>
<pre>
    complete -p
</pre>

<p>
Remove a specific completion specification:
</p>
<pre>
    complete -r {comp}
</pre>

<p>
Remove all completion specification:
</p>
<pre>
    complete -r
</pre>

<p>
Define a completion specification for default:
</p>
<pre>
    $ complete -D -W "1 2 3"
    $ &lt;tab&gt;&lt;tab&gt;
    1  2  3
    $ cmd &lt;tab&gt;&lt;tab&gt;
    1  2  3
</pre>

<p>
Define a completion specification for empty command:
</p>
<pre>
    $ complete -E -W "1 2 3"
    $ &lt;tab&gt;&lt;tab&gt;
    1  2  3
    $ cmd &lt;tab&gt;&lt;tab&gt;

</pre>

<p>
Define a completion specification by using <code>-G</code> option:
</p>
<pre>
    TODO: I don't know how to use this option. Please tell me if you know it.
</pre>

<p>
Define a completion specification by using <code>-W</code> option:
</p>
<pre>
    $ complete -W "1 2 3" cmd
    $ cmd &lt;tab&gt;&lt;tab&gt;
    1  2  3
</pre>

<p>
Define a completion specification by using <code>-F</code> option:
</p>
<pre>
    $ func() { COMPREPLY=( $(compgen -W "11 22 33" -- $2) ); }
    $ complete -F func cmd
    $ cmd &lt;tab&gt;&lt;tab&gt;
    11  22  33
</pre>

<p>
Define a completion specification which will add a suffix on each completion:
</p>
<pre>
    $ complete -W "1 2 3" -S "a" cmd
    $ cmd &lt;tab&gt;&lt;tab&gt;
    1a  2a  3a
</pre>

<div id="References"><h1 id="References">References</h1></div>

<ul>
<li>
  <code>man bash</code>

</ul>
</div>
    </div>
    <div id="footer">
        <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA</a> 2018-2019 an9wer | powered by <a href="https://github.com/vimwiki/vimwiki" target="_blank">vimwiki</a>
    </div>
<div>
</body>
</html>
