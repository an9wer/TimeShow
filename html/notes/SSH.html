<!DOCTYPE html>
<html>
<head>
    <title>an9wer's blog</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../statics/css/style.css" type="text/css" />
    <link rel="icon" href="../statics/images/icon.jpg" type="image/jpeg" size="32x32"/>
</head>
<body>
<div id="main">
    <div id="header">
        <div id="headerLeft">
            <div id="name"><a href="index.html">an9wer's blog</a></div>
            <div id="signature">just stick to it :)</div>
        </div>
        <div id="headerRight">
            <div id="avatar">
                <a href="https://github.com/an9wer" target="_blank"><img src="../statics/images/avatar.jpg"></a>
            </div>
        </div>
    </div>
    <div id="navbar">
        <a id="blog" href="../blog/index.html">Blog</a>
        <a id="notes" class="current" href="index.html">Notes</a>
        <a id="about" href="../about.html">About</a>
    </div>
    <div id="post">
        <div id="title">SSH</div>
        <div id="content">
<div id="Generating SSH keys"><h2 id="Generating SSH keys">Generating SSH keys</h2></div>

<pre>
    ssh-keygen -f ~/.ssh/an9wer_rsa -o -a 100 -t rsa -b 4096 -C "an9wer@gmail.com"
</pre>

<ul>
<li>
  <code>-f</code>: specifies the filename of the key file.

</ul>

<ul>
<li>
  <code>-t</code>: specifies the type of key to create.

</ul>

<ul>
<li>
  <code>-b</code>: specifies the number of bits in the key to create.

</ul>

<ul>
<li>
  <code>-o</code>: saves private keys using the new OpenSSH format rather than the more compatible PEM format. The new format has increased resistance to brute-force password cracking .

</ul>

<ul>
<li>
  <code>-a</code>: specifies the number of KDF (key derivation function) rounds used. Higher numbers result in slower passphrase verification and increased resistance to brute-force password cracking (should the keys be stolen).

</ul>

<ul>
<li>
  <code>-C</code>: provides a new comment.

</ul>

<div id="Copy public key to remote server"><h2 id="Copy public key to remote server">Copy public key to remote server</h2></div>

<pre>
    ssh-copy-id -i ~/.ssh/an9wer_rsa.pub an9wer@example.com
</pre>

<ul>
<li>
  <code>-i</code>: specifies the public key to be sent to remote server.

</ul>


<div id="SSH agents"><h2 id="SSH agents">SSH agents</h2></div>

<p>
Check whether SSH agent is started:
</p>

<pre>
    echo $SSH_AGENT_PID
</pre>

<p>
If some number display on the screen, it means the agent has been started.
Otherwise, you should run the following command to start it:
</p>

<pre>
    eval $(ssh-agent)
</pre>

<p>
You can also kill the current agent:
</p>

<pre>
    ssh-agent -k
</pre>

<div id="Add ssh key to agent"><h2 id="Add ssh key to agent">Add ssh key to agent</h2></div>

<p>
This command will add private ssh key <code>~/.ssh/an9wer_rsa</code> into authentication
agent.
</p>

<pre>
    ssh-add ~/.ssh/an9wer_rsa
</pre>

<div id="~/.ssh/config"><h2 id="~/.ssh/config">~/.ssh/config</h2></div>

<p>
If you want to setup aliases for servers you access often, you can create the
file <code>~/.ssh/config</code> and specify each server in it. A simple example is as
follows:
</p>

<pre>
    Host example0
        HostName example0.com

    Host example1
        HostName example1.com
        LocalForward 80 example.com:80

    Host *
        User an9wer
        Port 22
</pre>

<div id="SSH tunnels"><h2 id="SSH tunnels">SSH tunnels</h2></div>

<div id="SSH tunnels-Local port forwarding"><h3 id="Local port forwarding">Local port forwarding</h3></div>

<p>
The <code>-L</code> option of ssh binds the given port on local host to the given port on
remote host. Here's some examples:
</p>

<pre>
    ssh -fN -L 8000:github.com:80 user@example.com
</pre>

<p>
In this example, the server <code>example.com</code> will forward any connections from
port 8000 on local side to <code>github.com</code> at port 80. It's just like the server
<code>example.com</code> makes a tunnel between local and <code>github.com</code>.
</p>

<pre>
    ssh -fN -L 8000:localhost:80 user@example.com
</pre>

<p>
The difference between this example and previous one is the remote host being
changed to <code>localhost:80</code>. This means it will forward connectons from local
port 8000 to port 80 on <code>localhost</code> of the server <code>example.com</code>.
</p>

<div id="SSH tunnels-Remote port forwarding"><h3 id="Remote port forwarding">Remote port forwarding</h3></div>

<p>
The <code>-R</code> option of ssh specifies that the connection to the given port on remote
server will be forwarding to the local side.
</p>

<pre>
    ssh -fN -R 80:localhost:8000 user@example.com
</pre>

<p>
This command will forward connections from port 80 on the server <code>example.com</code>
to port 8000 on local side.
</p>

<p>
<span id="SSH tunnels-Remote port forwarding-Note"></span><strong id="Note">Note</strong>: SSH doesnâ€™t by default allow remote hosts to forwarded ports. To enable
this open <code>/etc/ssh/sshd_config</code> and add the following line somewhere in that
config file.
</p>

<pre>
    GatewayPorts yes
</pre>

<p>
Then when you connect to example.com:80, it'll forward to localhost:8000 on
local side. If you don't have <code>GatewayPorts yes</code> in your configuration file,
it'll only forward localhost:80 on example.com to localhost:8000 on local side.
</p>

<div id="autossh"><h2 id="autossh">autossh</h2></div>

<pre>
    autossh [-M port[:echo_port]] [-f] [SSH_OPTIONS]
</pre>

<ul>
<li>
  <code>-M</code>: specifies the base monitoring port to use.

</ul>

<ul>
<li>
  <code>-f</code>: causes autossh to drop to the background before running ssh.

</ul>

<p>
<span id="autossh-Note"></span><strong id="Note">Note</strong>: <code>-M 0</code> sets the monitor port to 0 turns the monitoring function off,
and autossh will only restart ssh upon ssh's exit. For example, if you are
using a recent version of OpenSSH, you may wish to explore using the
<code>ServerAliveInterval</code> and <code>ServerAliveCountMax</code> options to have the SSH client
exit if it finds itself no longer connected to the server. In many ways this
may be a better solution than the monitoring port.
</p>

<p>
<span id="autossh-Note"></span><strong id="Note">Note</strong>: There is a crucial a difference between <code>-f</code> with autossh, and <code>-f</code>
with ssh: when used with autossh ssh will be unable to ask for passwords or
passphrases. 
</p>

<p>
In the following example, autossh send data on port 20000 and receive it back
on 20001:
</p>

<pre>
    autossh -M 20000 -R 80:localhost:8000 an9wer@example.com
</pre>

<p>
In the following example, we turn the autossh monitoring function off, instead,
we use ssh built-in function to monitor connection:
</p>

<pre>
    autossh -M 0 -o "ServerAliveInterval 240" -o "ServerAliveCountMax 12" -R 80:localhost:8000 an9wer@example.com
</pre>

<p>
We can also write these options to <code>~/.ssh/config</code> file:
</p>

<pre>
    Host example
        HostName example.com
        User an9wer
        Port 22
        IdentityFile ~/.ssh/an9wer_rsa
        RemoteForward 80 localhost:8000
        ServerAliveInterval 240
        ServerAliveCountMax 12
</pre>

<p>
And we can run it easily by the following command:
</p>

<pre>
    autossh -M 0 -f -N example
</pre>

<div id="Acknowledgements"><h2 id="Acknowledgements">Acknowledgements</h2></div>

<ul>
<li>
  <a href="https://wiki.archlinux.org/index.php/SSH_keys">ssh key</a>

</ul>

<ul>
<li>
  <a href="https://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html">ssh tunnel</a>

</ul>

<ul>
<li>
  <a href="https://www.everythingcli.org/ssh-tunnelling-for-fun-and-profit-autossh/">autossh</a>

</ul>
</div>
    </div>
    <div id="footer">
        <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA</a> 2018 an9wer | powered by <a href="https://github.com/vimwiki/vimwiki" target="_blank">vimwiki</a>
    </div>
<div>
</body>
</html>
