<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<link rel="stylesheet" href="/statics/css/style.css" type="text/css" />
<link rel="stylesheet" href="/statics/css/icofont.css" type="text/css">
<link rel="icon" href="/statics/images/icon.jpg" type="image/jpeg" size="32x32" />
<body>
<div id="main">
<div id="header">
<div id="headerLeft">
<div id="name"><a href="/blog.html">an9wer's blog</a></div>
<div id="signature">Just stick to it :)</div>
</div> <!-- headerLeft -->
<div id="headerRight">
<div id="avatar"><img src="/statics/images/avatar.jpg"></div>
</div> <!-- headerRight -->
</div> <!-- header -->
<div id="navbar">
<a id="blog"
href="/blog.html">Blog</a>
<a id="notes"
class="current"
href="/notes.html">Notes</a>
<a id="tweet"
href="/tweet.html">Tweet</a>
<a id="about"
href="/about.html">About</a>
</div> <!-- navbar -->
<div id="post">
<div id="title">iptables</div>
<div id="content">
<div class="sect1">
<h2 id="_options">Options</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">-t table</span>: This option specifies the packet matching table  which the
    command should operate on. If the kernel is configured with automatic
    module loading, an attempt will be made to load the appropriate module for
    that table if it is not already there. The tables contain <span class="monospaced">filter</span>
    (default), <span class="monospaced">nat</span>, <span class="monospaced">mangle</span>, <span class="monospaced">raw</span> and <span class="monospaced">security</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">-A chain rule-specification</span>: Append one or more rules to the end of the
    selected chain. When the source and/or destiation names resolve the more
    than one address, a rule will be added for each possible address
    combination.
</p>
</li>
<li>
<p>
<span class="monospaced">-C chain rule-specification</span>: Check whether a rule matching the
    specification does exist in the selected chain. This command uses the same
    logic as <span class="monospaced">-D</span> to find a matching entry, but does not alter the existing
    iptables configuration and uses its exit code to indicate success or
    failure.
</p>
</li>
<li>
<p>
<span class="monospaced">-D chain rule-specification|rulenum</span>: Delete one or more rules from the
    selected chain. There are two verisons of this command: the rule can be
    specified as a number in the chain (starting at 1 for the first rule) or a
    rule to match.
</p>
</li>
<li>
<p>
<span class="monospaced">-I chain [rulenum] rule-specification</span>: Insert one or more rules in the
    selected chain as the given rule number. So, if the rule number is 1, the
    rule or rules are inserted at the head of the chain. This is also the
    default if no rule number is specified.
</p>
</li>
<li>
<p>
<span class="monospaced">-R chain rulenum rule-specification</span>: Replace a rule in the selected
    chain. If the source and/or destination names resolve to multiple address,
    the command will fail. Rule are numbered starting at 1.
</p>
</li>
<li>
<p>
<span class="monospaced">-L [chain]</span>: List all rules in the selected chain. If no chain is selecte,
    all chains are listed.
</p>
</li>
<li>
<p>
<span class="monospaced">-S [chain]</span>: Print all rules in the selected chain. If no chain is
    selected, all chains are printed like iptables-save.
</p>
</li>
<li>
<p>
<span class="monospaced">-F [chain]</span>: Flush the selected chain. This is equivalent to delete all
    the rules one by one.
</p>
</li>
<li>
<p>
<span class="monospaced">-Z [chain [rulenum]]</span>: Zero the packet and byte counters in all chains, or
    only the given chain, or only the given rule in a chain.
</p>
</li>
<li>
<p>
<span class="monospaced">-v</span>: Verbose output.
</p>
</li>
<li>
<p>
<span class="monospaced">-n</span>: Numeric output. IP address and port numbers will be printed in
    numeric format.
</p>
</li>
<li>
<p>
<span class="monospaced">-x</span>: Expand numbers. Display the exact value of the packet and byte
    counters, instead of only the rounded number in K&#8217;s (multiples of 1000) M&#8217;s
    (Multiples of 1000K) or G&#8217;s (multiples of 1000M). This option is only
    relevant for the <span class="monospaced">-L</span> option.
</p>
</li>
<li>
<p>
<span class="monospaced">--line-numbers</span>: When listing rules, add line numbers to the beginning of
    each rule, corresponding to that rule&#8217;s position in the chain.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Find more in <span class="monospaced">man iptbales</span>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_parameters">Parameters</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">[!] -p protocol</span>: The protocol of the rule or of the packet to check. The
    specified protocol can be one of tcp, udp, udplite, icmp, icmpv6, esp, ah,
    sctp, mh or the special keyword "all", or it can be a numeric value,
    representing one of these protocols or a different one. A prottocal name
    from <span class="monospaced">/etc/protocols</span> is also allowed. A "!" argument before the protocol
    inverts the test. The number zero is equivalent to "all". "all" will match
    with all protocols and is taken as default when this option is ommited.
</p>
</li>
<li>
<p>
<span class="monospaced">[!] -s address[/mask][,...]</span>: Source specification. Address can be either
    a network name, a hostname, a network IP address (with /mask), or a plain
    IP address. Hostname will be resolved once only, before the rule is
    submitted to the kernel. A "!" argument before the address specification
    inverts the sense of the address. Multiple address can be specified, but
    this will expand to multiple rules.
</p>
</li>
<li>
<p>
<span class="monospaced">[!] -d address[/mask][,...]</span>: Destination specification. (similar to <span class="monospaced">-s</span>
    option)
</p>
</li>
<li>
<p>
<span class="monospaced">-m match</span>: Specifies a match to use, that is, an extension module that
    test for a specific property.
</p>
</li>
<li>
<p>
<span class="monospaced">-j target</span>: Specifies the target of the rule; i.e., what to do if the
    packet matches it. The target can be a user-defined chain (other than the
    one this rule is in), one of the special builtin targets (ACCEPT, DROP,
    REJECT &#8230;) which decide the fate of the packet immediately, or an
    extension. If this option is omitted in a rule, then matching the rule will
    have no effect on the packet&#8217;s fate, but the counters on the rule will be
    increment.
</p>
</li>
<li>
<p>
<span class="monospaced">-c packets bytes</span>: Enables the administrator to initialize the packet and
    byte counters of a rule.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Find more in <span class="monospaced">man iptbales</span>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="paragraph"><p>Print all rules in <span class="monospaced">INPUT</span> chain of <span class="monospaced">filter</span> table.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -vS INPUT</pre>
</div></div>
<div class="paragraph"><p>List all rules in <span class="monospaced">INPUT</span> chain of <span class="monospaced">filter</span> table.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -nvL INPUT</pre>
</div></div>
<div class="paragraph"><p>List all rules in <span class="monospaced">INPUT</span> chain of <span class="monospaced">filter</span> table with line numbers.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -nvL INPUT --line-numbers</pre>
</div></div>
<div class="paragraph"><p>Allow a single IP address for incomming connection.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A INPUT -s 10.10.10.10  -j ACCEPT</pre>
</div></div>
<div class="paragraph"><p>Allow a range of IP addresses for incomming connection.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A INPUT -s 10.10.10.0/24 -j ACCEPT</pre>
</div></div>
<div class="paragraph"><p>Or:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A INPUT -s 10.10.10.0/255.255.255.0 -j ACCEPT</pre>
</div></div>
<div class="paragraph"><p>Block a specific port for incomming connection from any IP address.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A INPUT -p tcp -m tcp --dport 8000 -j DROP</pre>
</div></div>
<div class="paragraph"><p>Block a specific port for incomming connection from a specific IP address.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A INPUT -s 10.10.10.10 -p tcp -m tcp --dport 8000 -j DROP</pre>
</div></div>
<div class="paragraph"><p>Block to connect to a specific ip:port.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A OUTPUT -d 10.10.10.10 -p tcp -m tcp --dport 8000 -j DROP</pre>
</div></div>
<div class="paragraph"><p>Block to connect from a specific ip:port.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A INPUT -s 10.10.10.10 -p tcp -m tcp --sport 8000 -j DROP</pre>
</div></div>
<div class="paragraph"><p>Flush all rules in <span class="monospaced">INPUT</span> chain of filter table.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptable -F INPUT</pre>
</div></div>
<div class="paragraph"><p>Delete a specified rule by a rule number in <span class="monospaced">OUTPUT</span> chain of <span class="monospaced">filter</span> table.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -D OUTPUT 2</pre>
</div></div>
<div class="paragraph"><p>Clear byte counters in <span class="monospaced">OUTPUT</span> chain of <span class="monospaced">filter</span> table.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -Z OUTPUT</pre>
</div></div>
<div class="paragraph"><p><strong>Note</strong>:</p></div>
<div class="paragraph"><p>A lot of protocols are going to require two-way communication. For
example, if you want to allow SSH connections to your system, the input and
output chains are going to need a rule added to them. But, what if you only
want SSH coming into your system to be allowed? Won’t adding a rule to the
output chain also allow outgoing SSH attempts? That’s where connection states
come in, which give you the capability you’d need to allow two way
communication but only allow one way connections to be established.</p></div>
<div class="paragraph"><p>Take a look at this example, where SSH connections FROM 10.10.10.10 are
permitted, but SSH connections TO 10.10.10.10 are not. However, the system is
permitted to send back information over SSH as long as the session has already
been established, which makes SSH communication possible between these two
hosts.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A INPUT -p tcp --dport ssh -s 10.10.10.10 -m state --state NEW,ESTABLISHED -j ACCEPT
    sudo iptables -A OUTPUT -p tcp --sport 22 -d 10.10.10.10 -m state --state ESTABLISHED -j ACCEPT</pre>
</div></div>
<div class="paragraph"><p><strong>Note</strong>:</p></div>
<div class="paragraph"><p>To monitor a specific port for incomming connection from any IP address.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptabels -A INPUT -p tcp -m tcp --dport 10000
    sudo watch -n 1 iptables -vnL INPUT</pre>
</div></div>
<div class="paragraph"><p>To monitor a specific port for outgoing connection to any IP address.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables -A OUTPUT -p tcp -m tcp --sport 10000
    sudo watch -n 1 iptables -vnL OUTPUT</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_iptables_save">iptables-save</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_options_2">Options</h3>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">-t tablename</span>: Restrict output to only one table. If not specified, output
    include all avilable tables.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_examples_2">Examples ==</h3>
<div class="paragraph"><p>Save current rules to rule file:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables-save &gt; /path/to/iptables.rules</pre>
</div></div>
<div class="paragraph"><p>Save only <span class="monospaced">filter</span> table rule to rule file:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables-save -t filter &gt; /path/to/iptables.rules</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_iptables_restore">iptables-restore</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_options_3">Options</h3>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">-c</span>: Restore the values of all packet and byte counters.
</p>
</li>
<li>
<p>
<span class="monospaced">-n</span>: Don&#8217;t flush the previous contents of the table. If no specified, both
    commands flush al previous contents of the respective table.
</p>
</li>
<li>
<p>
<span class="monospaced">-t</span>: Only parse and construct the ruleset, but do not commit it.
</p>
</li>
<li>
<p>
<span class="monospaced">-T table</span>: Restore only the named table even if the input stream contains
    other ones.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Find more in <span class="monospaced">man iptbales-restore</span>.</p></div>
</div>
<div class="sect2">
<h3 id="_examples_3">Examples</h3>
<div class="paragraph"><p>Check all rules in rule file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables-restore -t /path/to/iptables.rules</pre>
</div></div>
<div class="paragraph"><p>Flush the previous rules and restore all rules from rule file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables-restore /path/to/iptables.rules</pre>
</div></div>
<div class="paragraph"><p>Do not flush the previous rules but only restore all rules from rule file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables-restore -n /path/to/iptables.rules</pre>
</div></div>
<div class="paragraph"><p>Restore only the <span class="monospaced">filter</span> table rules from rule file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables-restore -T filter /path/to/iptables.rules</pre>
</div></div>
<div class="paragraph"><p>Do not flush the previous rules but only restore the <span class="monospaced">filter</span> table rules form
rule file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    sudo iptables-restore -n -T filter /path/to/iptables.rules</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">man iptables</span>
</p>
</li>
<li>
<p>
<span class="monospaced">man iptables-extensions</span>
</p>
</li>
<li>
<p>
<a href="https://wiki.archlinux.org/index.php/iptables">archwiki iptables</a>
</p>
</li>
<li>
<p>
<a href="https://netfilter.org/index.html">netfilter</a>
</p>
</li>
<li>
<p>
<a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html">iptables tutorial</a>
</p>
</li>
<li>
<p>
<a href="https://opensource.com/article/18/9/linux-iptables-firewalld">difference between iptables and firewalld</a>
</p>
</li>
</ul></div>
</div>
</div>
</div> <!-- content -->
</div> <!-- post -->
<div id="footer">
<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA</a> 2018-2019 an9wer | powered by <a href="https://github.com/asciidoc/asciidoc-py3" target="_blank">asciidoc-py3</a>
</div> <!-- footer -->
</body>
</html>
