<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<link rel="stylesheet" href="/statics/css/style.css" type="text/css" />
<link rel="stylesheet" href="/statics/css/icofont.css" type="text/css">
<link rel="icon" href="/statics/images/icon.jpg" type="image/jpeg" size="32x32" />
<body>
<div id="main">
<div id="header">
<div id="headerLeft">
<div id="name"><a href="/blog.html">an9wer's blog</a></div>
<div id="signature">Just stick to it :)</div>
</div> <!-- headerLeft -->
<div id="headerRight">
<div id="avatar"><img src="/statics/images/avatar.jpg"></div>
</div> <!-- headerRight -->
</div> <!-- header -->
<div id="navbar">
<a id="blog"
href="/blog.html">Blog</a>
<a id="notes"
class="current"
href="/notes.html">Notes</a>
<a id="tweet"
href="/tweet.html">Tweet</a>
<a id="about"
href="/about.html">About</a>
</div> <!-- navbar -->
<div id="post">
<div id="title">Bash Completion</div>
<div id="content">
<div class="sect1">
<h2 id="_programmable_completion">Programmable Completion</h2>
<div class="sectionbody">
<div class="paragraph"><p>When word completion is attempted for an argument to a command for which a
completion specification (a compspec) has been defined using the <span class="monospaced">complete</span>
builtin, the programmable completion facilities are invoked.</p></div>
<div class="paragraph"><p>First, the command name is identified. If the command word is the empty string
(completion attempted at the beginning of an empty line), any compspec defined
with the <span class="monospaced">-E</span> option to <span class="monospaced">complete</span> is used. If a compspec has been defined for
that command, the compspec is used to generate the list of possible completions
for the word. If the command word is a full pathname, a compspec for the full
pathname, an attempt is made to find a compspec for the portion following the
final slash. If those searches do not result in a compspec, any compspec
defined with the <span class="monospaced">-D</span> option to <span class="monospaced">complete</span> is used as the default. If there is
no default compspec, bash attempts alias expansion on the command word as a
final resort, and attempts to find a compspec for the command word from any
successful expansion.</p></div>
<div class="paragraph"><p>Once a compspec has been found, it is used to generate the list of matching
words. If a compspec is not found, the default bash completion as described
above under Completing is performed.</p></div>
<div class="paragraph"><p>First, the actions specified by the compspec are used. Only mathes which are
prefixed by the word being completed are returned. When the <span class="monospaced">-f</span> or <span class="monospaced">-d</span> option
is used for filename or directory name completion, the shell variable
<span class="monospaced">FIGNOREB</span> is used to filter the matches.</p></div>
<div class="paragraph"><p>Any completions specified by a pathname expansion pattern to the <span class="monospaced">-G</span> option
are generated next. The words generated by the pattern need not match the word
being completed. The <span class="monospaced">GLOBIGNORE</span> shell variable is not used to filter the
matches, but the <span class="monospaced">FIGNORE</span> variable is used.</p></div>
<div class="paragraph"><p>Next, the string specified as the argument to the <span class="monospaced">-W</span> option is considered.
The string is first split using the characters in the <span class="monospaced">IFS</span> special variable as
delimiters. Shell quotiong is hornored. Each word is then expanded using brace
expansion, tilde expansion, parameter and variable expansion, command
substitution, and arithmetic expansion. The results are split using the Word
Spliting rules. The results of the expansion are prefix-matched against the
word being completed, and the matching words become the possible completions.</p></div>
<div class="paragraph"><p>After these matches have been generated, any shell function or command
specified with the <span class="monospaced">-F</span> and <span class="monospaced">-C</span> options is invoked. When the command or
function is invoked, the <span class="monospaced">COMP_LINE</span>, <span class="monospaced">COMP_POINT</span>, <span class="monospaced">COMP_KEY</span>, and <span class="monospaced">COMP_TYPE</span>
variables are assigned values. If a shell function is being invoked, the
<span class="monospaced">COMP_WORDS</span> and <span class="monospaced">COMP_CWORD</span> variables are also set. When the function or
command is invoked, the first argument ($1) is the name of the command whose
arguments are being completed, the second argument ($2) is the word being
completed on the current command line. No filtering of the generated
completions against the word being completed is performed; the function or
command has complete freedom in generating the matches.</p></div>
<div class="paragraph"><p>Any function specified with <span class="monospaced">-F</span> is invoked first. The function may use any of
the shell facilities, including the <span class="monospaced">compgen</span> builtin. to generate the matches.
It must put the possible completions in the <span class="monospaced">COMPREPLY</span> array variable, one per
array element.</p></div>
<div class="paragraph"><p>Next, any command specified with the <span class="monospaced">-C</span> option is invoked in an environment
equivalent to command substitution. It should print a list of completions, one
per line, to the standard output. Backslash may be used to escape a newline, if
necessary.</p></div>
<div class="paragraph"><p>After all of the possible completions are generated, any filter specified with
the <span class="monospaced">-X</span> option is applied to the list. The filter is a pattern as used for
pathname expansion; a <span class="monospaced">&amp;</span> in the pattern is replaced with the text of the word
being completed. A literal <span class="monospaced">&amp;</span> may be escaped with a backslash; the backslash
is removed berfore attempting a match. Any completion that matches the pattern
will be removed from the list. A leading <span class="monospaced">!</span> negates the pattern; in this case
any completion not matching the pattern will be removed. If the <span class="monospaced">nocasematch</span>
shell option is enabled, the match is performed without regard to the case of
alphabetic characters.</p></div>
<div class="paragraph"><p>Finally, any prefix and suffix specified with the <span class="monospaced">-P</span> and <span class="monospaced">-S</span> options are
added to each member of the completion list, and the result is returned to the
readline completion code as the list of possible completions.</p></div>
<div class="paragraph"><p>If the previously-applied actions do not generate any matches, and the
<span class="monospaced">-o dirname</span> option was supplied to <span class="monospaced">complete</span> when the compspec was defined,
directory name completion is attempted.</p></div>
<div class="paragraph"><p>If the <span class="monospaced">-o plusdirs</span> option was supplied to <span class="monospaced">complete</span> when the compspec was
defined, directory name completion is attempted and any matches are added to
the results of the other actions.</p></div>
<div class="paragraph"><p>By default , if a compspec is found, whatever it generates is returned to the
completion code as the full set of possible completions. The default bash
completions are not attempted, and the readline default of filename completion
is disbled. If the <span class="monospaced">-o bashdefault</span> option was supplied to <span class="monospaced">complete</span> when the
compspec was defined, the bash bash default completions are attempeted if the
compspec generates no matches. If the <span class="monospaced">-o default</span> option was supplied to
compspec when the compspec was defined, readline&#8217;s default completion will be
performed if the compspec (and, if attempted, the default bash completions)
generate no matches.</p></div>
<div class="paragraph"><p>When a compspec indicates that direcotry name completion is desired, the
programmable completion functions force readline to append a slash to completed
names which are symbolic links to directories, subject to the value of the
<span class="monospaced">mark-directories</span> readline variable, regardless of the setting of the
<span class="monospaced">mark-symlinked-direcotries</span> readline variable.</p></div>
<div class="paragraph"><p>There is some support for dynamically modifying completions. This is most
useful when used in combination with a default completion specified with
<span class="monospaced">complete -D</span>. It&#8217;s possible for shell functions execute as completion handlers
to indicate teh completion should be retried by returning an exit status of
124. If a shell function returns 124, and changes the compspec associated with
the command on which completion is being attempted (supplied as the first
argument when the function is executed), programmable completion restarts from
the beginning, with an attempt to find a new compspec for that command. This
allows a set of completions to be built dynameically as completion is
attempted, rather than being loaded all at once.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_compgen">compgen</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content monospaced">
<pre>    compgen [option] [word]</pre>
</div></div>
<div class="paragraph"><p>Generate possible completion matches for word according to the options, which
may be any option accepted by the <span class="monospaced">complete</span> builtin with the exception of <span class="monospaced">-p</span>
and <span class="monospaced">-r</span>, and write the matches to the standard output. When using the <span class="monospaced">-F</span> or
<span class="monospaced">-C</span> options, the various shell variables set by the programmable completion
facilities, while available, will not have useful values.</p></div>
<div class="paragraph"><p>The matches will be generated in the same way as if the programmable completion
code had generated them directly from a completion specification with the same
flags. If word is specified, only those completions matching word will be
displayed.</p></div>
<div class="paragraph"><p>The return value is true unless an invalid option is supplied, or no matches
were generated.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_complete">complete</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content monospaced">
<pre>    complete [-abcdefgjksuv] [-o comp-option] [-DE] [-A action] [-G globpat]
        [-W wordlist] [-F function] [-C command] [-X filterpat] [-P prefix]
        [-S suffix] name [name ...]</pre>
</div></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    complete -pr [-DE] [name ...]</pre>
</div></div>
<div class="paragraph"><p>Specify how arguments to each name should be completed. If the <span class="monospaced">-p</span> option is
supplied, or if no options are supplied, existing completion specifications are
printed in a way that allows them to be reused as input. The <span class="monospaced">-r</span> option
removes a completion specification for each name, or, if no names are supplied,
all completion specifications. The <span class="monospaced">-D</span> option indicates that the remaining
options and actions should apply to the "default" command completion; that is,
completion attempted on a command for which no completion has previously been
defined. The <span class="monospaced">-E</span> option indicates that the remaining options and actions
should apply to "empty" command completion; that is, completion attempted on a
blank line.</p></div>
<div class="paragraph"><p>Other options, if specified, have the following meanings. The arguments to the
<span class="monospaced">-G</span>, <span class="monospaced">-W</span>, and <span class="monospaced">-X</span> options (and, if necessary, the <span class="monospaced">-P</span> and <span class="monospaced">-S</span> options)
should be quoted to protect them from expansion before the complete builtin is
invoked.</p></div>
<div class="paragraph"><p><span class="monospaced">-o comp-option</span>: The comp-option controls several aspects of the compspec&#8217;s
behavior beyond the simple generation of completions.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">bashdefault</span>: Perform the rest of the default bash completions if the
    compspec generates no matches.
</p>
</li>
<li>
<p>
<span class="monospaced">default</span>: Use readline&#8217;s default filename completion if the compspec
    generates no matches.
</p>
</li>
<li>
<p>
<span class="monospaced">dirnames</span>: Perform directory name completion if the compspec generates no
    matches
</p>
</li>
<li>
<p>
<span class="monospaced">filenames</span>: Tell readline that the compspec generates filenames, so it can
    perform any filename-specific processing (like adding a slash to directory
    names, quoting special characters, or suppressing trailing spaces).
    Intended to be used with shell functions.
</p>
</li>
<li>
<p>
<span class="monospaced">noquote</span>: Tell readline not to quote the completed words if they are
    filenames (quoting filenames is the default).
</p>
</li>
<li>
<p>
<span class="monospaced">nosort</span>: Tell readline not to sort the list of possible completions
    alphabetically.
</p>
</li>
<li>
<p>
<span class="monospaced">nospace</span>: Tell readline not to append a space (the default) to words
    completed at the end of the line.
</p>
</li>
<li>
<p>
<span class="monospaced">plusdirs</span>: After any matches defined by the compspec are generated,
    directory name completion is attempted and any matches are added to the
    results of the other actions.
</p>
</li>
</ul></div>
<div class="paragraph"><p><span class="monospaced">-A action</span>: The action may be one of the following to generate a list of
possible completions:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">alias</span>: Alias names. May also be specified as <span class="monospaced">-a</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">arrayvar</span>: Array variable names.
</p>
</li>
<li>
<p>
<span class="monospaced">binding</span>: Readline keybinding names.
</p>
</li>
<li>
<p>
<span class="monospaced">builtin</span>: Names of shell builtin commands. May also be specified as <span class="monospaced">-b</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">command</span>: Command names. May also be specified as <span class="monospaced">-c</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">directory</span>: Directory names. May also be specified as <span class="monospaced">-d</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">disabled</span>: Name of disabled shell builtins.
</p>
</li>
<li>
<p>
<span class="monospaced">enabled</span>: Name of enabled shell builtins.
</p>
</li>
<li>
<p>
<span class="monospaced">export</span>: Name of exported shell variables. May also be specified as <span class="monospaced">-e</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">file</span>: File name. May also be specified as <span class="monospaced">-f</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">function</span>: Names of shell functios.
</p>
</li>
<li>
<p>
<span class="monospaced">group</span>: Group names. May also be specified as <span class="monospaced">-g</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">helptopic</span>: Help topics as accepted by the <span class="monospaced">help</span> builtin.
</p>
</li>
<li>
<p>
<span class="monospaced">hostname</span>: Hostname, as taken from the file specified by the <span class="monospaced">HOSTFILE</span>
    shell variable.
</p>
</li>
<li>
<p>
<span class="monospaced">job</span>: Job names, if job control is active. May also be specified as <span class="monospaced">-j</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">keyword</span>: SHell reserved words. May also be specified as <span class="monospaced">-k</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">running</span>: Names of running jobs, if job control is active.
</p>
</li>
<li>
<p>
<span class="monospaced">service</span>: Service names. May also be specified as <span class="monospaced">-s</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">setopt</span>: Valid arguments for the <span class="monospaced">-o</span> option to the <span class="monospaced">set</span> builtin.
</p>
</li>
<li>
<p>
<span class="monospaced">shopt</span>: Shell option names as accepted by the <span class="monospaced">shopt</span> builtin.
</p>
</li>
<li>
<p>
<span class="monospaced">signal</span>: Signal names.
</p>
</li>
<li>
<p>
<span class="monospaced">stopped</span>: Names of stopped jobs, if job control is active.
</p>
</li>
<li>
<p>
<span class="monospaced">user</span>: User names, May also be specified by <span class="monospaced">-u</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">variable</span>: Names of all shell veriables. May also be specified as <span class="monospaced">-v</span>.
</p>
</li>
</ul></div>
<div class="paragraph"><p><span class="monospaced">-C command</span>: command is executed in subshell environment, and its output is
used as the possible completions.</p></div>
<div class="paragraph"><p><span class="monospaced">-F function</span>: The shell function function is executed in the current shell
environment. When the function is executed, the first argument ($1) is the name
of the command whose arguments are being completed, the second argument ($2) is
the word being completed, and the third argument ($3) is the word preceding the
word being completed on the current command line. When it finishes, the
possible completions are retrieved from teh value of the <span class="monospaced">COMPREPLY</span> array
variable.</p></div>
<div class="paragraph"><p><span class="monospaced">-G globpat</span>: The pathname expansion pattern globpat is expanded to generate
the possible completions.</p></div>
<div class="paragraph"><p><span class="monospaced">-P prefix</span>: prefix is added at the beginning of each possible completion after
all other options have been applied.</p></div>
<div class="paragraph"><p><span class="monospaced">-S suffix</span>: suffix is appended to each possible completion after all other
options have been applied.</p></div>
<div class="paragraph"><p><span class="monospaced">-W wordlist</span>: The wordlist is split using the characters in the IFS special
variable as delimiters, and each resultant word is expanded. The possible
completions are the members of the resultant list which match the word being
completed.</p></div>
<div class="paragraph"><p><span class="monospaced">-X filterpat</span>: filterpat is a pattern as used for pathname expansion. It is
applied to the list of possible completions generated by the preceding options
and arguments, and each completion matching filterpat is removed from the list.
A leading ! in filterpat negates the pattern; in this case, any completion not
matching filterpat is removed.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_compopt">compopt</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content monospaced">
<pre>    compopt [-o option] [-DE] [+o option] [name]</pre>
</div></div>
<div class="paragraph"><p>Modify completion options for each name according to the options, or for the
currently-executing completion if no names are supplied. If no options are
given, display the completion options for each name or the current completion.
The possible values of option are those valid for the <span class="monospaced">complete</span> builtin. The
<span class="monospaced">-D</span> option indicates that the remaining options should apply to the "default"
command completion; that is, completion attempted on a command for which no
completion has previously been defined. The <span class="monospaced">-E</span> option indicates that the
remaining options should apply to "empty" command completion; that is,
completion attempted on a blank line.</p></div>
<div class="paragraph"><p>The return value is true unless an invalid option is supplied, an attempt is
made to modify the options for a name for which no completion specification
exists, or an output error occurs.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="paragraph"><p>Display all existing completion specification:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    complete</pre>
</div></div>
<div class="paragraph"><p>Or:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    complete -p</pre>
</div></div>
<div class="paragraph"><p>Remove a specific completion specification:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    complete -r {comp}</pre>
</div></div>
<div class="paragraph"><p>Remove all completion specification:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    complete -r</pre>
</div></div>
<div class="paragraph"><p>Define a completion specification for default:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    $ complete -D -W "1 2 3"
    $ &lt;tab&gt;&lt;tab&gt;
    1  2  3
    $ cmd &lt;tab&gt;&lt;tab&gt;
    1  2  3</pre>
</div></div>
<div class="paragraph"><p>Define a completion specification for empty command:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    $ complete -E -W "1 2 3"
    $ &lt;tab&gt;&lt;tab&gt;
    1  2  3
    $ cmd &lt;tab&gt;&lt;tab&gt;</pre>
</div></div>
<div class="paragraph"><p>Define a completion specification by using <span class="monospaced">-G</span> option:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    TODO: I don't know how to use this option. Please tell me if you know it.</pre>
</div></div>
<div class="paragraph"><p>Define a completion specification by using <span class="monospaced">-W</span> option:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    $ complete -W "1 2 3" cmd
    $ cmd &lt;tab&gt;&lt;tab&gt;
    1  2  3</pre>
</div></div>
<div class="paragraph"><p>Define a completion specification by using <span class="monospaced">-F</span> option:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    $ func() { COMPREPLY=( $(compgen -W "11 22 33" -- $2) ); }
    $ complete -F func cmd
    $ cmd &lt;tab&gt;&lt;tab&gt;
    11  22  33</pre>
</div></div>
<div class="paragraph"><p>Define a completion specification which will add a suffix on each completion:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    $ complete -W "1 2 3" -S "a" cmd
    $ cmd &lt;tab&gt;&lt;tab&gt;
    1a  2a  3a</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">man bash</span>
</p>
</li>
</ul></div>
</div>
</div>
</div> <!-- content -->
</div> <!-- post -->
<div id="footer">
<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA</a> 2018-2019 an9wer | powered by <a href="https://github.com/asciidoc/asciidoc-py3" target="_blank">asciidoc-py3</a>
</div> <!-- footer -->
</body>
</html>
